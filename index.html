<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Urban Guessr</title>
		<link rel="stylesheet" href="style.css">
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		<script src="https://rawgit.com/chrisma/jquery.scorenotify/master/jquery.scorenotify.js"></script>
	</head>
	<body>
		<div id="centered_helper">
			<div id="main">
				<div id="content">
					<div id="ribbon">
						<div id="number">1.</div>
					</div>
					<div class="status">
						<div id="correct">&#x2714;<!-- U+2714 HEAVY CHECK MARK --></div>
						<div id="wrong">&#x2716;<!-- U+2716 HEAVY MULTIPLICATION X --></div>
					</div>
					<div id="dictionary_entry">
						<div id="word">
							<input type="text" autofocus placeholder="Gimme your best guess">
						</div>
						<div id="definition">This is a word. It has a definition. This definition appears here. As it is sourced from urbandictionary.com it will probably contain some profanity.</div>
						<div id="example">This is an example where the word is used in a sentence / context.</div>
					</div>
				</div>
				<div id="scoreboard">
					<p><span id="currentTerm">1</span> / 10 terms</p>
					<p><span id="points">0</span> points</p>
				</div>
			</div>
		</div>

		<script type="text/javascript">
			// x = defaultValue(x,42), encapsulate default parameter handling
			function defaultValue(variable, defaultVal) {
				return typeof variable !== 'undefined' ? variable : defaultVal;
			}

			// Censor / replace the word with black blocks,
			// Leave the first spare amount letters untouched.
			String.prototype.censor = function(word, spare, censoredClass, revealedClass) {
				censoredClass = defaultValue(censoredClass, 'censored');
				revealedClass = defaultValue(revealedClass, 'revealed');
				spare = defaultValue(spare, 0);
				var replacement = [];
				word.split(' ').forEach(function(part) {
					// Cannot spare more characters than the word has
					var wordSpare = spare > part.length ? part.length : spare;
					// U+2588 is FULL BLOCK
					var censored = new Array(part.length+1-wordSpare).join('\u2588');
					var str = '<span class="' + revealedClass + '">' + part.slice(0,wordSpare) + '</span>' + '<span class="' + censoredClass + '">' + censored + '</span>';
					replacement.push(str);
				});
				replacement = replacement.join(' ');
				return this.replace(new RegExp(word,'gi'), replacement);
			}

			String.prototype.remove = function() {
				var result = this;
				for (var i = 0; i < arguments.length; i++) {
					result = result.replace(arguments[i],'');
				}
				return result;
			}

			var list;
			var current;
			$(document).ready(function() {
				current = 0;
				var points = 0;
				var ud_random_url = 'http://api.urbandictionary.com/v0/random';

				$.getJSON(ud_random_url, function(json){
					console.log(json);
					list = json["list"];
					list.forEach(function(entry) {
						entry.definition = entry.definition.remove(/\[/g,/\]/g).censor(entry.word);
						entry.example = entry.example.censor(entry.word);
					});
					showNextEntry();
				})
					.fail(function(data){
						console.log("ERROR", data)
					});

				function showNextEntry(){
					console.log(current);
					current += 1;
					$('input').val('');
					$('#correct').hide();
					$('#wrong').hide();
					$('#currentTerm').text(current);
					var entry = list[current-1];
					$('#definition').html(entry.definition);
					$('#example').html(entry.example);
					console.log("Upvotes:", entry.thumbs_up, "downvotes:", entry.thumbs_down);
				}

				$('input').keyup(function(e){
					if (e.keyCode == 13) { //Enter
						checkGuess();
					}
				});

				function checkGuess(){
					var guess = $('input').val();
					if (guess.toLowerCase() === list[current-1].word.toLowerCase()) {
						$('#points').scoreNotify({ value: 100, add_class: 'score_notify'});
						points += 100;
						$('#correct').show();
						$('#points').text(points);
						setTimeout(showNextEntry, 1500);
					} else {
						$('#wrong').show();
						setTimeout(function(){$('#wrong').hide();}, 1000);
					}
				};
			});
		</script>
	</body>
</html>
